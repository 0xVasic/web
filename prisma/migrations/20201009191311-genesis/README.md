# Migration `20201009191311-genesis`

This migration has been generated by Southclaws at 10/9/2020, 8:13:11 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"id" text   NOT NULL ,
"email" text   NOT NULL ,
"name" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Server" (
"id" text   NOT NULL ,
"ip" text   NOT NULL ,
"hn" text   NOT NULL ,
"pc" integer   NOT NULL ,
"pm" integer   NOT NULL ,
"gm" text   NOT NULL ,
"la" text   NOT NULL ,
"pa" boolean   NOT NULL ,
"vn" text   NOT NULL ,
"domain" text   ,
"description" text   ,
"banner" text   ,
"userId" text   ,
"active" boolean   NOT NULL ,
"updatedAt" timestamp(3)   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Rule" (
"id" SERIAL,
"name" text   NOT NULL ,
"value" text   NOT NULL ,
"serverId" text   ,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Server.ip_unique" ON "public"."Server"("ip")

CREATE UNIQUE INDEX "Rule_serverId_rule_name_index" ON "public"."Rule"("name", "serverId")

ALTER TABLE "public"."Server" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Rule" ADD FOREIGN KEY ("serverId")REFERENCES "public"."Server"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201009191311-genesis
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,57 @@
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider      = "go run github.com/prisma/prisma-client-go"
+  output        = "../server/src/db"
+  package       = "db"
+  binaryTargets = ["native"]
+}
+
+model User {
+  id      String   @id @default(uuid())
+  email   String
+  name    String
+  servers Server[]
+}
+
+model Server {
+  id String @id @default(uuid())
+
+  // essential data (short names to save data!)
+  ip String  @unique
+  hn String
+  pc Int
+  pm Int
+  gm String
+  la String
+  pa Boolean
+  vn String
+  ru Rule[]
+
+  // domain name for de-duplication purposes
+  domain String?
+
+  // rich data (entered by server owners via the web UI)
+  description String?
+  banner      String?
+
+  // user who owns this server
+  User   User?   @relation(fields: [userId], references: [id])
+  userId String?
+
+  active    Boolean
+  updatedAt DateTime @updatedAt
+}
+
+model Rule {
+  id       Int     @id @default(autoincrement())
+  name     String
+  value    String
+  Server   Server? @relation(fields: [serverId], references: [id])
+  serverId String?
+
+  @@unique([name, serverId], name: "Rule_serverId_rule_name_index")
+}
```


